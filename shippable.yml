language: go

go:
  - 1.8

branches:
  only:
    - develop
    - master

env:
  global:
    - AWS_ACCOUNT_ID: 960785399995
    - AWS_REGION: us-east-1

build:
  ci:
    # Run our tests
    - mkdir -p shippable/testresults
    - go get github.com/jstemmer/go-junit-report
    - go test -v ./... | tee test.out
    - cat test.out | go-junit-report > shippable/testresults/report.xml
    # Build our Docker image
    - docker build -t $AWS_ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/hello-server:$COMMIT .

# post_ci:
    # - docker push $AWS_ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/hello-server:$COMMIT

# integrations:
  # hub:
  #   - integrationName: aws-keys-integration
  #     region: $AWS_REGION
  #     type: ecr

  notifications:
    - integrationName: email
      type: email
      on_success: always
      on_failure: always
      on_pull_request: never
      sendFailingSnippet: true
      recipients:
        - dmcclure@redventures.com